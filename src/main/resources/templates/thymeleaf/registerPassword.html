<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect" />
    <link
      as="style"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans+KR%3Awght%40400%3B500%3B700%3B900&amp;family=Work+Sans%3Awght%40400%3B500%3B700%3B900"
      onload="this.rel='stylesheet'"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined"
      rel="stylesheet"
    />
    <title>CatDogEats 직원 계정 활성화</title>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/css">
      body {
        font-family: "Noto Sans KR", "Work Sans", sans-serif;
        background: linear-gradient(135deg, #faf8f5 0%, #f5f0e8 100%);
        min-height: 100vh;
      }

      .setup-container {
        background-color: white;
        border-radius: 1rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        border: 1px solid #f0ebe5;
      }

      .primary-bg {
        background-color: #f5a623;
      }

      .primary-text {
        color: #f5a623;
      }

      .accent-text {
        color: #7d6e63;
      }

      .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: #7d6e63;
        margin-bottom: 0.5rem;
      }

      .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #cbd5e1;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        color: #374151;
        background-color: white;
        transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      }

      .form-input:focus {
        outline: none;
        border-color: #f5a623;
        box-shadow: 0 0 0 3px rgba(245, 166, 35, 0.1);
      }

      .form-input:disabled {
        background-color: #f8fafc;
        color: #64748b;
        cursor: not-allowed;
      }

      .setup-button {
        width: 100%;
        padding: 0.875rem;
        background-color: #f5a623;
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out,
          transform 0.1s ease-in-out;
      }

      .setup-button:hover {
        background-color: #e69500;
        transform: translateY(-1px);
      }

      .setup-button:active {
        transform: translateY(0);
      }

      .setup-button:disabled {
        background-color: #cbd5e1;
        cursor: not-allowed;
        transform: none;
      }

      .error-message {
        background-color: #fee2e2;
        border: 1px solid #fecaca;
        color: #dc2626;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        display: none;
      }

      .success-message {
        background-color: #dcfce7;
        border: 1px solid #bbf7d0;
        color: #15803d;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        display: none;
      }

      .info-message {
        background-color: #dbeafe;
        border: 1px solid #93c5fd;
        color: #1d4ed8;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
      }

      .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        margin-bottom: 2rem;
      }

      .logo-icon {
        width: 3rem;
        height: 3rem;
        color: #f5a623;
      }

      .loading-spinner {
        display: none;
        width: 1rem;
        height: 1rem;
        border: 2px solid transparent;
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .input-group {
        position: relative;
      }

      .input-icon {
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        font-size: 1.25rem;
      }

      .input-with-icon {
        padding-left: 2.75rem;
      }

      .password-toggle {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        cursor: pointer;
        font-size: 1.25rem;
        transition: color 0.2s ease-in-out;
      }

      .password-toggle:hover {
        color: #6b7280;
      }

      .password-requirements {
        background-color: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 0.5rem;
      }

      .requirement {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.75rem;
        color: #64748b;
        margin-bottom: 0.25rem;
      }

      .requirement.valid {
        color: #22c55e;
      }

      .requirement.invalid {
        color: #ef4444;
      }

      .requirement:last-child {
        margin-bottom: 0;
      }

      .employee-info {
        background: linear-gradient(
          135deg,
          rgba(245, 166, 35, 0.1) 0%,
          rgba(245, 166, 35, 0.05) 100%
        );
        border: 1px solid rgba(245, 166, 35, 0.2);
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        text-align: center;
      }

      .welcome-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background-color: #f5a623;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 1.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 1rem;
      }

      .email-display {
        font-size: 1.125rem;
        font-weight: 600;
        color: #374151;
        background-color: white;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        border: 1px solid #e5e7eb;
        margin: 0.5rem 0;
      }

      .redirect-info {
        background-color: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 0.5rem;
        padding: 1rem;
        text-align: center;
        margin-top: 1.5rem;
      }

      .countdown {
        font-size: 0.875rem;
        color: #f5a623;
        font-weight: 600;
        text-align: center;
        margin-top: 1rem;
      }

      /* 모바일 반응형 */
      @media (max-width: 640px) {
        .setup-container {
          margin: 1rem;
          padding: 1.5rem;
        }

        .employee-info {
          padding: 1rem;
        }

        .email-display {
          font-size: 1rem;
          word-break: break-all;
        }
      }
    </style>
  </head>
  <body>
    <div class="min-h-screen flex items-center justify-center p-4">
      <div class="setup-container w-full max-w-md p-8">
        <!-- 로고 -->
        <div class="logo-container">
          <div class="logo-icon">
            <svg
              fill="none"
              viewBox="0 0 48 48"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M32.9392 10.7307C32.0655 10.4106 31.134 10.2503 30.1954 10.2589H29.747C26.3663 10.2589 23.4064 12.0854 21.7295 14.8563C20.0527 12.0854 17.0928 10.2589 13.7121 10.2589H13.2637C12.3251 10.2503 11.3936 10.4106 10.52 10.7307C6.2872 12.3058 3.34436 16.4118 3.34436 21.1279C3.34436 27.4542 10.0706 33.2441 19.1119 38.0983C20.2683 38.7325 21.6107 39.076 22.9831 39.076C24.3555 39.076 25.6979 38.7325 26.8543 38.0983C35.8956 33.2441 42.6218 27.4542 42.6218 21.1279C42.6218 16.4118 39.679 12.3058 35.4462 10.7307H32.9392Z"
                fill="currentColor"
              ></path>
              <path
                d="M34.5763 21.813C34.5763 22.2145 34.2561 22.5347 33.8546 22.5347H29.9871L24.0362 32.0712C23.8229 32.4247 23.4134 32.6305 22.9831 32.6305C22.5527 32.6305 22.1432 32.4247 21.9299 32.0712L15.9791 22.5347H12.1115C11.7101 22.5347 11.39 22.2145 11.39 21.813C11.39 21.4116 11.7101 21.0914 12.1115 21.0914H16.4973C16.8988 21.0914 17.259 21.3438 17.4148 21.7093L22.9831 30.6195L28.5513 21.7093C28.7071 21.3438 29.0673 21.0914 29.4688 21.0914H33.8546C34.2561 21.0914 34.5763 21.4116 34.5763 21.813Z"
                fill="white"
              ></path>
            </svg>
          </div>
          <h1 class="text-2xl font-bold accent-text">CatDogEats</h1>
        </div>

        <!-- 직원 정보 표시 -->
        <div class="employee-info">
          <div class="welcome-badge">
            <span class="material-icons-outlined text-sm">person_add</span>
            계정 활성화
          </div>
          <h2 class="text-lg font-semibold accent-text mb-2">직원 계정 설정</h2>
          <p class="text-sm text-slate-600 mb-3">
            관리자가 생성한 계정입니다.<br />
            안전한 비밀번호를 설정하여 계정을 활성화하세요.
          </p>

          <!-- 이메일 표시 -->
          <div class="text-sm text-slate-500 mb-2">계정 이메일</div>
          <div class="email-display" id="employeeEmail">
            employee@catdogeats.com
          </div>
        </div>

        <!-- 안내 메시지 -->
        <div class="info-message mb-4">
          <div class="flex items-center gap-2">
            <span class="material-icons-outlined text-sm">info</span>
            <span>처음 로그인하는 계정입니다. 비밀번호를 설정해주세요.</span>
          </div>
        </div>

        <!-- 알림 메시지 -->
        <div id="errorMessage" class="error-message mb-4">
          <div class="flex items-center gap-2">
            <span class="material-icons-outlined text-sm">error</span>
            <span id="errorText">오류가 발생했습니다.</span>
          </div>
        </div>

        <div id="successMessage" class="success-message mb-4">
          <div class="flex items-center gap-2">
            <span class="material-icons-outlined text-sm">check_circle</span>
            <span>계정이 성공적으로 활성화되었습니다!</span>
          </div>
        </div>

        <!-- 비밀번호 설정 폼 -->
        <form id="passwordSetupForm" onsubmit="handlePasswordSetup(event)">
          <div class="mb-4">
            <label class="form-label" for="newPassword">새 비밀번호</label>
            <div class="input-group">
              <span class="material-icons-outlined input-icon">lock</span>
              <input
                type="password"
                id="newPassword"
                class="form-input input-with-icon"
                placeholder="     안전한 비밀번호를 입력하세요"
                required
                autocomplete="new-password"
                oninput="validatePassword()"
              />
              <span
                class="material-icons-outlined password-toggle"
                onclick="togglePasswordVisibility('newPassword', 'newPasswordToggle')"
                id="newPasswordToggle"
              >
                visibility_off
              </span>
            </div>

            <!-- 비밀번호 요구사항 -->
            <div class="password-requirements">
              <div class="text-xs font-semibold text-slate-600 mb-2">
                비밀번호 요구사항:
              </div>
              <div class="requirement" id="lengthReq">
                <span class="material-icons-outlined text-xs">close</span>
                8자 이상
              </div>
              <div class="requirement" id="upperReq">
                <span class="material-icons-outlined text-xs">close</span>
                대문자 포함
              </div>
              <div class="requirement" id="lowerReq">
                <span class="material-icons-outlined text-xs">close</span>
                소문자 포함
              </div>
              <div class="requirement" id="numberReq">
                <span class="material-icons-outlined text-xs">close</span>
                숫자 포함
              </div>
              <div class="requirement" id="specialReq">
                <span class="material-icons-outlined text-xs">close</span>
                특수문자 포함 (!@#$%^&*)
              </div>
            </div>
          </div>

          <div class="mb-6">
            <label class="form-label" for="confirmPassword"
              >비밀번호 확인</label
            >
            <div class="input-group">
              <span class="material-icons-outlined input-icon">lock</span>
              <input
                type="password"
                id="confirmPassword"
                class="form-input input-with-icon"
                placeholder="     비밀번호를 다시 입력하세요"
                required
                autocomplete="new-password"
                oninput="checkPasswordMatch()"
              />
              <span
                class="material-icons-outlined password-toggle"
                onclick="togglePasswordVisibility('confirmPassword', 'confirmPasswordToggle')"
                id="confirmPasswordToggle"
              >
                visibility_off
              </span>
            </div>
            <div
              id="passwordMatch"
              class="text-xs mt-1"
              style="display: none"
            ></div>
          </div>

          <!-- 추가 정보 입력 (선택사항) -->
          <div class="mb-6">
            <label class="form-label" for="employeeName">이름 (선택사항)</label>
            <div class="input-group">
              <span class="material-icons-outlined input-icon">person</span>
              <input
                type="text"
                id="employeeName"
                class="form-input input-with-icon"
                placeholder="     실명을 입력하세요"
                autocomplete="name"
              />
            </div>
            <p class="text-xs text-slate-500 mt-1">
              프로필에 표시될 이름입니다. 나중에 변경할 수 있습니다.
            </p>
          </div>

          <button type="submit" id="setupButton" class="setup-button" disabled>
            <div class="flex items-center justify-center gap-2">
              <div id="setupSpinner" class="loading-spinner"></div>
              <span id="setupButtonText">계정 활성화</span>
            </div>
          </button>
        </form>

        <!-- 완료 후 안내 -->
        <div id="successStep" style="display: none">
          <div class="redirect-info">
            <div class="flex items-center justify-center gap-2 mb-3">
              <span class="material-icons-outlined text-blue-600"
                >check_circle</span
              >
              <span class="font-semibold text-blue-800">계정 활성화 완료!</span>
            </div>
            <p class="text-sm text-blue-700 mb-3">
              CatDogEats 직원 계정이 성공적으로 생성되었습니다.
            </p>
            <div class="countdown" id="redirectCountdown">
              <span id="redirectTime">5</span>초 후 로그인 페이지로 이동합니다
            </div>
            <a
              href="/admin/login"
              class="setup-button block text-center text-white no-underline mt-4"
              style="text-decoration: none"
            >
              지금 로그인하기
            </a>
          </div>
        </div>

        <!-- 추가 정보 -->
        <div class="mt-6 text-center">
          <div
            class="flex items-center gap-2 justify-center text-sm text-slate-500 mb-3"
          >
            <span class="material-icons-outlined text-sm">security</span>
            <span>안전한 비밀번호를 설정하여 계정을 보호하세요</span>
          </div>
          <p class="text-xs text-slate-400">
            문제가 발생하면 관리자에게 문의하세요
          </p>
        </div>
      </div>
    </div>

    <script>
      let redirectTimer = null;

      // 비밀번호 보기/숨기기
      function togglePasswordVisibility(inputId, toggleId) {
        const input = document.getElementById(inputId);
        const toggle = document.getElementById(toggleId);

        if (input.type === "password") {
          input.type = "text";
          toggle.textContent = "visibility";
        } else {
          input.type = "password";
          toggle.textContent = "visibility_off";
        }
      }

      // 비밀번호 유효성 검사
      function validatePassword() {
        const password = document.getElementById("newPassword").value;

        // 요구사항 체크
        const requirements = {
          length: password.length >= 8,
          upper: /[A-Z]/.test(password),
          lower: /[a-z]/.test(password),
          number: /[0-9]/.test(password),
          special: /[!@#$%^&*]/.test(password),
        };

        // UI 업데이트
        updateRequirement("lengthReq", requirements.length);
        updateRequirement("upperReq", requirements.upper);
        updateRequirement("lowerReq", requirements.lower);
        updateRequirement("numberReq", requirements.number);
        updateRequirement("specialReq", requirements.special);

        // 모든 요구사항 충족 여부 확인
        const allValid = Object.values(requirements).every((req) => req);

        // 비밀번호 확인란 체크
        checkPasswordMatch();

        return allValid;
      }

      // 요구사항 UI 업데이트
      function updateRequirement(elementId, isValid) {
        const element = document.getElementById(elementId);
        const icon = element.querySelector(".material-icons-outlined");

        if (isValid) {
          element.className = "requirement valid";
          icon.textContent = "check";
        } else {
          element.className = "requirement invalid";
          icon.textContent = "close";
        }
      }

      // 비밀번호 일치 확인
      function checkPasswordMatch() {
        const password = document.getElementById("newPassword").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const matchElement = document.getElementById("passwordMatch");
        const submitButton = document.getElementById("setupButton");

        if (!confirmPassword) {
          matchElement.style.display = "none";
          submitButton.disabled = true;
          return;
        }

        matchElement.style.display = "block";

        if (password === confirmPassword) {
          matchElement.textContent = "✓ 비밀번호가 일치합니다";
          matchElement.style.color = "#22c55e";

          // 모든 요구사항이 충족되면 버튼 활성화
          if (validatePassword()) {
            submitButton.disabled = false;
          }
        } else {
          matchElement.textContent = "✗ 비밀번호가 일치하지 않습니다";
          matchElement.style.color = "#ef4444";
          submitButton.disabled = true;
        }
      }

      // 비밀번호 설정 처리
      function handlePasswordSetup(event) {
        event.preventDefault();

        const newPassword = document.getElementById("newPassword").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const employeeName = document.getElementById("employeeName").value;
        const employeeEmail =
          document.getElementById("employeeEmail").textContent;

        const button = document.getElementById("setupButton");
        const buttonText = document.getElementById("setupButtonText");
        const spinner = document.getElementById("setupSpinner");
        const errorMsg = document.getElementById("errorMessage");
        const successMsg = document.getElementById("successMessage");

        if (newPassword !== confirmPassword) {
          errorMsg.style.display = "block";
          document.getElementById("errorText").textContent =
            "비밀번호가 일치하지 않습니다.";
          return;
        }

        button.disabled = true;
        buttonText.textContent = "계정 생성 중...";
        spinner.style.display = "block";
        errorMsg.style.display = "none";
        successMsg.style.display = "none";

        // 계정 활성화 시뮬레이션
        setTimeout(() => {
          // 성공 시나리오
          successMsg.style.display = "block";

          // 폼 숨기고 완료 화면 표시
          document.getElementById("passwordSetupForm").style.display = "none";
          document.getElementById("successStep").style.display = "block";

          // 리다이렉트 카운트다운 시작
          startRedirectCountdown();

          // 콘솔에 설정 정보 출력 (개발용)
          console.log("계정 생성 완료:", {
            email: employeeEmail,
            name: employeeName || "미입력",
            password: "설정됨",
          });
        }, 2000);
      }

      // 리다이렉트 카운트다운
      function startRedirectCountdown() {
        let timeLeft = 5;

        redirectTimer = setInterval(() => {
          document.getElementById("redirectTime").textContent = timeLeft;

          if (timeLeft <= 0) {
            clearInterval(redirectTimer);
            window.location.href = "/admin/login";
          }

          timeLeft--;
        }, 1000);
      }

      // 폼 검증 상태 업데이트
      function updateFormValidation() {
        const password = document.getElementById("newPassword").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const button = document.getElementById("setupButton");

        const isPasswordValid = validatePassword();
        const isPasswordMatch =
          password === confirmPassword && confirmPassword.length > 0;

        button.disabled = !(isPasswordValid && isPasswordMatch);
      }

      // 페이지 로드 시 초기화
      document.addEventListener("DOMContentLoaded", function () {
        console.log("직원 계정 설정 페이지 로드 완료");

        // URL 파라미터에서 이메일 가져오기 (선택사항)
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get("email");
        if (email) {
          document.getElementById("employeeEmail").textContent = email;
        }

        // 개발용 빠른 입력 버튼 (localhost에서만)
        if (
          window.location.hostname === "localhost" ||
          window.location.hostname === "127.0.0.1"
        ) {
          const quickFillBtn = document.createElement("button");
          quickFillBtn.innerHTML = "빠른 입력 (개발용)";
          quickFillBtn.style.cssText = `
            position: fixed; 
            top: 10px; 
            right: 10px; 
            background: #f59e0b; 
            color: white; 
            border: none; 
            padding: 8px 12px; 
            border-radius: 4px; 
            font-size: 12px; 
            cursor: pointer; 
            z-index: 1000;
          `;
          quickFillBtn.onclick = function () {
            document.getElementById("newPassword").value = "Password123!";
            document.getElementById("confirmPassword").value = "Password123!";
            document.getElementById("employeeName").value = "김직원";
            validatePassword();
            checkPasswordMatch();
          };
          document.body.appendChild(quickFillBtn);
        }
      });

      // 실시간 폼 검증을 위한 이벤트 리스너
      document
        .getElementById("newPassword")
        .addEventListener("input", updateFormValidation);
      document
        .getElementById("confirmPassword")
        .addEventListener("input", updateFormValidation);

      // 키보드 단축키 (Enter로 폼 제출)
      document.addEventListener("keydown", function (e) {
        if (e.key === "Enter" && !e.shiftKey) {
          const form = document.getElementById("passwordSetupForm");
          if (form.style.display !== "none") {
            e.preventDefault();
            if (!document.getElementById("setupButton").disabled) {
              form.dispatchEvent(new Event("submit"));
            }
          }
        }
      });
    </script>
  </body>
</html>
