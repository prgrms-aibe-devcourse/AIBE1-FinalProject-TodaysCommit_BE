<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect" />
    <link
            as="style"
            href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans+KR%3Awght%40400%3B500%3B700%3B900&amp;family=Work+Sans%3Awght%40400%3B500%3B700%3B900"
            onload="this.rel='stylesheet'"
            rel="stylesheet"
    />
    <link
            href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined"
            rel="stylesheet"
    />
    <title>CatDogEats Admin - 설정</title>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/css">
        body {
            font-family: "Noto Sans KR", "Work Sans", sans-serif;
            background-color: #faf8f5;
        }
        .primary-bg {
            background-color: #f5a623;
        }
        .primary-text {
            color: #f5a623;
        }
        .secondary-text {
            color: #a5d6a7;
        }
        .accent-text {
            color: #7d6e63;
        }
        .secondary-bg {
            background-color: #e8f5e9;
        }
        .active-tab {
            border-left-width: 4px;
            border-color: #f5a623;
            background-color: #fff9f0;
            color: #f5a623;
            font-weight: 700;
        }
        .inactive-tab {
            border-left-width: 4px;
            border-color: transparent;
            color: #7d6e63;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        .inactive-tab:hover {
            background-color: #fdfbf8;
            color: #e69500;
        }
        .page-title {
            color: #7d6e63;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .page-subtitle {
            color: #a89a91;
            font-size: 1rem;
        }
        .sidebar {
            background-color: #fffdfb;
            border-right: 1px solid #f0ebe5;
        }
        .sidebar-link-icon {
            color: #bcaaa4;
        }
        .sidebar-link-text {
            color: #7d6e63;
        }
        .active-tab .sidebar-link-icon,
        .active-tab .sidebar-link-text {
            color: #f5a623;
        }
        .inactive-tab:hover .sidebar-link-icon,
        .inactive-tab:hover .sidebar-link-text {
            color: #e69500;
        }
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #7d6e63;
            margin-bottom: 0.5rem;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: #374151;
            background-color: white;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .form-input:focus {
            outline: none;
            border-color: #f5a623;
            box-shadow: 0 0 0 1px #f5a623;
        }
        .form-input:disabled {
            background-color: #f8fafc;
            color: #6b7280;
            cursor: not-allowed;
        }
        .action-button {
            display: flex;
            min-width: 84px;
            max-width: 480px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-radius: 0.375rem;
            height: 2.75rem;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out;
            text-decoration: none;
        }
        .primary-button {
            background-color: #f5a623;
            color: white;
        }
        .primary-button:hover {
            background-color: #e69500;
            color: white;
        }
        .secondary-button {
            background-color: #f8fafc;
            color: #374151;
            border: 1px solid #cbd5e1;
        }
        .secondary-button:hover {
            background-color: #f1f5f9;
            border-color: #94a3b8;
            color: #374151;
            text-decoration: none;
        }
        .danger-button {
            background-color: #dc2626;
            color: white;
        }
        .danger-button:hover {
            background-color: #b91c1c;
            color: white;
        }
        .section-header {
            color: #7d6e63;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
        }
        .settings-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            border: 1px solid #f0ebe5;
        }
        .user-menu {
            position: relative;
            display: inline-block;
        }
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        .user-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: #374151;
            text-decoration: none;
            font-size: 0.875rem;
            transition: background-color 0.15s ease-in-out;
        }
        .dropdown-item:hover {
            background-color: #f9fafb;
            color: #111827;
            text-decoration: none;
        }
        .dropdown-item.danger {
            color: #dc2626;
        }
        .dropdown-item.danger:hover {
            background-color: #fef2f2;
            color: #b91c1c;
        }
        .alert {
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            border: 1px solid;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            display: none;
        }
        .alert-success {
            background-color: #dcfce7;
            border-color: #bbf7d0;
            color: #15803d;
        }
        .alert-error {
            background-color: #fee2e2;
            border-color: #fecaca;
            color: #dc2626;
        }
        .loading-spinner {
            display: none;
            width: 1rem;
            height: 1rem;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-FAF8F5">
<div
        class="relative flex size-full min-h-screen flex-row group/design-root overflow-x-hidden"
>
    <aside
            class="sidebar w-64 flex-shrink-0 flex flex-col space-y-2 py-6 px-4"
    >
        <div class="flex items-center gap-3 px-3 mb-6">
            <div class="size-8 text-orange-500">
                <svg
                        fill="none"
                        viewBox="0 0 48 48"
                        xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                            d="M32.9392 10.7307C32.0655 10.4106 31.134 10.2503 30.1954 10.2589H29.747C26.3663 10.2589 23.4064 12.0854 21.7295 14.8563C20.0527 12.0854 17.0928 10.2589 13.7121 10.2589H13.2637C12.3251 10.2503 11.3936 10.4106 10.52 10.7307C6.2872 12.3058 3.34436 16.4118 3.34436 21.1279C3.34436 27.4542 10.0706 33.2441 19.1119 38.0983C20.2683 38.7325 21.6107 39.076 22.9831 39.076C24.3555 39.076 25.6979 38.7325 26.8543 38.0983C35.8956 33.2441 42.6218 27.4542 42.6218 21.1279C42.6218 16.4118 39.679 12.3058 35.4462 10.7307H32.9392Z"
                            fill="#F5A623"
                    ></path>
                    <path
                            d="M34.5763 21.813C34.5763 22.2145 34.2561 22.5347 33.8546 22.5347H29.9871L24.0362 32.0712C23.8229 32.4247 23.4134 32.6305 22.9831 32.6305C22.5527 32.6305 22.1432 32.4247 21.9299 32.0712L15.9791 22.5347H12.1115C11.7101 22.5347 11.39 22.2145 11.39 21.813C11.39 21.4116 11.7101 21.0914 12.1115 21.0914H16.4973C16.8988 21.0914 17.259 21.3438 17.4148 21.7093L22.9831 30.6195L28.5513 21.7093C28.7071 21.3438 29.0673 21.0914 29.4688 21.0914H33.8546C34.2561 21.0914 34.5763 21.4116 34.5763 21.813Z"
                            fill="white"
                    ></path>
                </svg>
            </div>
            <h2
                    class="text-orange-500 text-xl font-bold leading-tight tracking-[-0.015em]"
            >
                CatDogEats <br />관리자 페이지
            </h2>
        </div>
        <nav class="flex flex-col space-y-1">
            <a
                    class="inactive-tab flex items-center gap-3 px-3 py-2.5 rounded-md"
                    href="/v1/admin/dashboard"
            >
            <span class="material-icons-outlined sidebar-link-icon text-xl"
            >dashboard</span
            >
                <span class="sidebar-link-text text-sm font-medium">대시보드</span>
            </a>
            <a
                    class="inactive-tab flex items-center gap-3 px-3 py-2.5 rounded-md"
                    href="/v1/admin/invite"
            >
            <span class="material-icons-outlined sidebar-link-icon text-xl"
            >person_add</span
            >
                <span class="sidebar-link-text text-sm font-medium">계정 생성</span>
            </a>
            <a
                    class="inactive-tab flex items-center gap-3 px-3 py-2.5 rounded-md"
                    href="#"
            >
            <span class="material-icons-outlined sidebar-link-icon text-xl"
            >report_problem</span
            >
                <span class="sidebar-link-text text-sm font-medium">신고 관리</span>
            </a>
            <a
                    class="inactive-tab flex items-center gap-3 px-3 py-2.5 rounded-md"
                    href="#"
            >
            <span class="material-icons-outlined sidebar-link-icon text-xl"
            >campaign</span
            >
                <span class="sidebar-link-text text-sm font-medium"
                >공지사항 관리</span
                >
            </a>
            <a
                    class="inactive-tab flex items-center gap-3 px-3 py-2.5 rounded-md"
                    href="#"
            >
            <span class="material-icons-outlined sidebar-link-icon text-xl"
            >quiz</span
            >
                <span class="sidebar-link-text text-sm font-medium">FAQ 관리</span>
            </a>
            <a
                    class="inactive-tab flex items-center gap-3 px-3 py-2.5 rounded-md"
                    href="#"
            >
            <span class="material-icons-outlined sidebar-link-icon text-xl"
            >support_agent</span
            >
                <span class="sidebar-link-text text-sm font-medium"
                >1:1 문의 관리</span
                >
            </a>
        </nav>
        <div class="mt-auto pt-4 border-t border-beige-200">
            <a
                    class="active-tab flex items-center gap-3 px-3 py-2.5 rounded-md"
                    href="/v1/admin/settings"
            >
            <span class="material-icons-outlined sidebar-link-icon text-xl"
            >settings</span
            >
                <span class="sidebar-link-text text-sm font-medium">설정</span>
            </a>
        </div>
    </aside>
    <div class="layout-container flex h-full grow flex-col">
        <header
                class="flex items-center justify-between whitespace-nowrap border-b border-solid border-slate-200 bg-white px-6 py-3 shadow-sm"
        >
            <div class="flex items-center"></div>
            <div class="flex flex-1 justify-end gap-6 items-center">
                <span class="text-sm accent-text">admin@catdogeats.com</span>
                <div class="user-menu">
                    <div
                            class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border border-slate-200 cursor-pointer"
                            style="
                  background-image: url('https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face');
                "
                            onclick="toggleUserMenu()"
                    ></div>
                    <div class="user-dropdown" id="userDropdown">
                        <a href="/v1/admin/profile" class="dropdown-item">
                            <span class="material-icons-outlined text-base mr-3">person</span>
                            프로필
                        </a>
                        <a href="/v1/admin/settings" class="dropdown-item">
                            <span class="material-icons-outlined text-base mr-3">settings</span>
                            설정
                        </a>
                        <hr class="my-1 border-gray-200">
                        <form action="/v1/admin/logout" method="post" style="display: inline; width: 100%;">
                            <button type="submit" class="dropdown-item danger w-full text-left border-0 bg-transparent">
                                <span class="material-icons-outlined text-base mr-3">logout</span>
                                로그아웃
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </header>
        <main
                class="px-6 md:px-10 lg:px-16 xl:px-20 flex flex-1 flex-col py-8 bg-FAF8F5"
        >
            <div class="flex flex-col w-full max-w-4xl mx-auto">
                <div class="mb-8">
                    <h1 class="page-title">설정</h1>
                    <p class="page-subtitle">
                        관리자 계정 정보와 시스템 설정을 관리합니다.
                    </p>
                </div>

                <!-- 알림 메시지 -->
                <div id="alertContainer"></div>

                <!-- 계정 정보 섹션 -->
                <div class="settings-card">
                    <h2 class="section-header">계정 정보</h2>
                    <form id="accountForm" class="space-y-6" onsubmit="handleAccountUpdate(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="form-label" for="admin-name">이름</label>
                                <input
                                        class="form-input"
                                        id="admin-name"
                                        name="admin-name"
                                        placeholder="관리자 이름을 입력하세요"
                                        type="text"
                                        value="관리자"
                                        required
                                />
                            </div>
                            <div>
                                <label class="form-label" for="admin-email">이메일</label>
                                <input
                                        class="form-input"
                                        id="admin-email"
                                        name="admin-email"
                                        placeholder="이메일 주소"
                                        type="email"
                                        value="admin@catdogeats.com"
                                        disabled
                                />
                                <p class="text-sm text-slate-500 mt-2">이메일은 변경할 수 없습니다.</p>
                            </div>
                        </div>
                        <div>
                            <label class="form-label" for="admin-department">부서</label>
                            <input
                                    class="form-input"
                                    id="admin-department"
                                    name="admin-department"
                                    placeholder="부서명"
                                    type="text"
                                    value="시스템 관리팀"
                                    disabled
                            />
                            <p class="text-sm text-slate-500 mt-2">부서는 변경할 수 없습니다.</p>
                        </div>
                        <div class="flex justify-start">
                            <button type="submit" class="action-button primary-button" id="saveButton">
                                <div class="flex items-center justify-center gap-2">
                                    <div id="saveSpinner" class="loading-spinner"></div>
                                    <span class="material-icons-outlined text-base" id="saveIcon">save</span>
                                    <span id="saveText">변경사항 저장</span>
                                </div>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 보안 설정 섹션 -->
                <div class="settings-card">
                    <h2 class="section-header">보안 설정</h2>
                    <div class="space-y-6">
                        <div
                                class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
                        >
                            <div>
                                <h3 class="accent-text font-medium">비밀번호</h3>
                                <p class="text-sm text-slate-500">
                                    보안을 위해 정기적으로 비밀번호를 변경해주세요
                                </p>
                            </div>
                            <a href="/v1/admin/change-password" class="action-button secondary-button">
                                <span class="material-icons-outlined text-base mr-2">lock</span>
                                비밀번호 변경
                            </a>
                        </div>

                        <div
                                class="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
                        >
                            <div>
                                <h3 class="accent-text font-medium">로그인 기록</h3>
                                <p class="text-sm text-slate-500">최근 로그인 활동을 확인하세요</p>
                            </div>
                            <button class="action-button secondary-button" onclick="showLoginHistory()">
                                <span class="material-icons-outlined text-base mr-2">history</span>
                                기록 보기
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 로그아웃 섹션 -->
                <div class="settings-card">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-red-700 font-medium">로그아웃</h3>
                            <p class="text-sm text-red-600">
                                관리자 계정에서 안전하게 로그아웃합니다
                            </p>
                        </div>
                        <form action="/v1/admin/logout" method="post" style="display: inline;">
                            <button type="submit" class="action-button danger-button">
                                <span class="material-icons-outlined text-base mr-2">logout</span>
                                로그아웃
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
    // 사용자 메뉴 토글
    function toggleUserMenu() {
        const dropdown = document.getElementById('userDropdown');
        dropdown.classList.toggle('active');
    }

    // 외부 클릭 시 메뉴 닫기
    document.addEventListener('click', function(event) {
        const userMenu = document.querySelector('.user-menu');
        const dropdown = document.getElementById('userDropdown');

        if (!userMenu.contains(event.target)) {
            dropdown.classList.remove('active');
        }
    });

    // 계정 정보 업데이트 처리
    async function handleAccountUpdate(event) {
        event.preventDefault();

        const name = document.getElementById('admin-name').value.trim();

        if (!name) {
            showAlert('이름을 입력해주세요.', 'error');
            return;
        }

        setLoading(true);
        hideAlerts();

        try {
            // 서버로 계정 정보 업데이트 요청
            const response = await fetch('/v1/admin/profile/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify({
                    name: name
                })
            });

            const result = await response.json();

            if (response.ok && result.success) {
                showAlert('계정 정보가 성공적으로 업데이트되었습니다.', 'success');
            } else {
                const errorMessage = result.message || "업데이트에 실패했습니다.";
                showAlert(errorMessage, 'error');
            }
        } catch (error) {
            console.error('계정 정보 업데이트 중 오류:', error);
            showAlert("서버 연결에 문제가 발생했습니다.", 'error');
        } finally {
            setLoading(false);
        }
    }

    // 로그인 기록 보기
    function showLoginHistory() {
        alert('로그인 기록 기능은 추후 구현될 예정입니다.');
    }

    // UI 헬퍼 함수들
    function setLoading(isLoading) {
        const button = document.getElementById("saveButton");
        const saveText = document.getElementById("saveText");
        const saveIcon = document.getElementById("saveIcon");
        const spinner = document.getElementById("saveSpinner");

        button.disabled = isLoading;
        saveText.textContent = isLoading ? "저장 중..." : "변경사항 저장";
        saveIcon.style.display = isLoading ? "none" : "block";
        spinner.style.display = isLoading ? "block" : "none";
    }

    function showAlert(message, type) {
        const alertContainer = document.getElementById('alertContainer');
        const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
        const iconName = type === 'success' ? 'check_circle' : 'error';

        alertContainer.innerHTML = `
          <div class="alert ${alertClass}" style="display: flex;">
            <span class="material-icons-outlined text-base">${iconName}</span>
            <span>${message}</span>
          </div>
        `;

        // 5초 후 자동 숨김
        setTimeout(() => {
            hideAlerts();
        }, 5000);
    }

    function hideAlerts() {
        document.getElementById('alertContainer').innerHTML = '';
    }

    // 페이지 로드 시 관리자 정보 불러오기
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            const response = await fetch('/v1/admin/profile', {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });

            if (response.ok) {
                const result = await response.json();
                if (result.success && result.data) {
                    const adminData = result.data;
                    document.getElementById('admin-name').value = adminData.name || '';
                    document.getElementById('admin-email').value = adminData.email || '';
                    document.getElementById('admin-department').value = getDepartmentDisplayName(adminData.department) || '';

                    // 헤더의 이메일도 업데이트
                    const headerEmail = document.querySelector('header .accent-text');
                    if (headerEmail) {
                        headerEmail.textContent = adminData.email;
                    }
                }
            }
        } catch (error) {
            console.error('관리자 정보 로딩 중 오류:', error);
        }
    });

    // 부서 표시명 변환
    function getDepartmentDisplayName(department) {
        const departmentNames = {
            'ADMIN': '관리팀',
            'DEVELOPMENT': '개발팀',
            'CUSTOMER_SERVICE': '고객서비스팀',
            'OPERATIONS': '운영팀'
        };
        return departmentNames[department] || department;
    }
</script>
</body>
</html>